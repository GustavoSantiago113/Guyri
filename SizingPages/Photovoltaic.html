<html>
    <head>
        <title>
            Guyri - Photovoltaic
        </title>
        <link rel="icon" href="../Icons/Logotipo 2.png">
        <link rel="stylesheet" type="text/css" href="../style.css">
        <script src="../functions.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    </head>
    <header class="header">
        <img class="logo_header" src="../Icons/Logotipo 2.png">
        <div class="title_header">
            <h1 style="background-color: #b5e8c3; font-size: 30px;">ARA</h1>
            <h3 style="background-color: #b5e8c3; font-size: larger;">BIOSYSTEMS</h3>
        </div>
        <a class="return_initial" href="../index.html">Home</a>
    </header>
    <body>
    <div class="body_sizing">   
        <div class="main_lateral_dropdown">

            <div class="lateral_dropdown">
                <button class="lateral_dropbtn">
                    <img class="icon" src="../Icons/irrigation.png">
                </button>
                <div class="lateral_dropdown-content">
                    <a class="link" href="Dripping.html">Dripping</a>
                    <a class="link" href="Sprinkling.html">Sprinkling</a>
                    <a class="link" href="Micro_Sprinkling.html">Micro-Sprinkling</a>
                    <a class="link" href="Center_Pivot.html">Center Pivot</a>
                </div>
            </div>

            <div class="lateral_dropdown">
                <button class="lateral_dropbtn">
                    <img class="icon" src="../Icons/solar-energy.png">
                </button>
                <div class="lateral_dropdown-content">
                    <a class="link" href="Solar_Heating.html">Solar Heating</a>
                    <a class="link" href="Photovoltaic.html">Photovoltaic</a>
                    <a class="link" href="Wind.html">Wind</a>
                    <a class="link" href="Hydroeletric.html">Hydroelectric</a>
                </div>
            </div>

            <div class="lateral_dropdown">
                <button class="lateral_dropbtn">
                    <img class="icon" src="../Icons/bacteria.png">
                </button>
                <div class="lateral_dropdown-content">
                    <a class="link" href="Biodigester.html">Biodigester</a>
                    <a class="link" href="Composting.html">Composting</a>
                </div>
            </div>

            <div class="lateral_dropdown">
                <button class="lateral_dropbtn">
                    <img class="icon" src="../Icons/greenhouse.png">
                </button>
                <div class="lateral_dropdown-content">
                    <a class="link" href="Forced_Ventilation.html">Forced Ventilation</a>
                    <a class="link" href="Air_Conditioning.html">Air Conditioning</a>
                    <a class="link" href="Fogging.html">Fogging</a>
                </div>
            </div>

            <div class="lateral_dropdown">
                <button class="lateral_dropbtn">
                    <img class="icon" src="../Icons/dollar-currency-symbol.png">
                </button>
                <div class="lateral_dropdown-content">
                    <a class="link" href="Economical_Analysis.html">Economic analysis</a>
                </div>
            </div>

        </div>

            <div class="main_section">
                <div class="calculator">

                    <ul class="nav">
                        <button class="nav_link active" id="par_bt" onclick="openTab(event, 'par')">System parameters</button>
                        <button class="nav_link" id="tipo_bt" onclick="openTab(event, 'tipo')">System type</button>
                    </ul>

                    <div class="tab_content">

                        <div class="tab_pane" id="par">
                            <input class="input" placeholder="Average monthly consumption (kWh/month)" type="number" step="0.0001" id="Ctm">
                            <br><input class="input" placeholder="Hours of full sun in the most critical month (h/day)" type="number" step="0.0001" id="Hspd">
                            <br><input class="input" placeholder="Panel Power (W)" type="number" step="0.0001" id="Pp">
                            <br><input class="input" placeholder="Module Efficiency (%)" type="number" step="0.0001" id="Em">
                        </div>

                        <div class="tab_pane" id="tipo" style="display: none;">
                            <h5 style="background-color: #65b8a6;">System type:</h5>
                            <input type="radio" name="tipo" id="ongrid" onclick="AparecerSolar();"><span>On-Grid</span>
                            <input type="radio" name="tipo" id="offgrid" onclick="AparecerSolar();"><span>Off-Grid</span>
                            <div id="inputoffgrid" style="display:none; background-color: #65b8a6;">
                                <br><input class="input" placeholder="Autonomy (days)" type="number" step="0.0001" id="Autonomia">
                                <br><input class="input" placeholder="Module Voltage" type="number" step="0.0001" id="TM">
                                <br><input class="input" placeholder="Battery bank voltage" type="number" step="0.0001" id="Tbb">       
                            </div>
                        </div>

                    </div>

                </div>

                <button class="result" onclick="DimensionarSolar('minhaDiv');" data-bs-toggle="modal" data-bs-target="#exampleModal">
                    Size!
                </button>

            </div>

            <div>
                
            </div>

    </div>

    <div class="modal fade" id="exampleModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title">Results</h5>
                </div>
                <div class="modal-body">
                    <div id="report">
                        <div class="header_report">
                                <h1 style="background-color: #b5e8c3; font-size: 30px;">ARA</h1>
                                <h3 style="background-color: #b5e8c3; font-size: larger;">BIOSYSTEMS</h3>     
                        </div>
                        <div>
                            <div class="subtitle_report">
                                <h3>Energy</h3>
                                <h4>Photovoltaic</h4>
                            </div>
                            <h5 style="padding-left: 15px;">Inputs</h5>
                            <div class="box_report">
                                <h6 style="background-color: #65b8a6;font-size: 15px;">System parameters</h6>
                                <span>Average monthly consumption (kWh/month): </span><span id="CtmReport"></span>
                                <br><span>Hours of full sun in the most critical month (h/day): </span><span id="HspdReport"></span>
                                <br><span>Panel Power (W): </span><span id="PpReport"></span>
                                <br><span>Module Efficiency (%): </span><span id="EmReport"></span>
                            </div>
                            <div class="box_report">
                                <h6 style="background-color: #65b8a6;font-size: 15px;">System type</h6>
                                <span id="OnorOffReport"></span>
                                <div id="inputoffgridReport" style="display:none; background-color: #65b8a6;">
                                    <span>Autonomy (days): </span><span id="AutonomiaReport"></span>
                                    <br><span>Module Voltage: </span><span id="TMReport"></span>
                                    <br><span>Battery bank voltage: </span><span id="TbbReport"></span>     
                                </div>
                            </div>
                            <h5 style="padding-left: 15px;">Outputs</h5>
                            <div class="box_report">
                                <span>Number of panels needed: </span><span id="TRD"></span>
                                <br><span>Inverter Power (W): <span id="PI"></span>
                                <br>
                                <div id="resultoffgrid" style="display:none;background-color: #65b8a6;">
                                    <h6 style="background-color: #65b8a6;">Battery bank</h6>
                                    <span>Battery capacity (Ah): </span><span id="Cb"></span>
                                    <br><span>Charge controller (A): </span><span id="Cc"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="GenerateReport()">Generate Report</button>
                </div>
            </div>
        </div>
    </div>

    </body>
    <script>
        function GenerateReport(){

            const element = document.getElementById('report');
            var opt = {
                filename:     "ARA_Biosystems_Photovoltaic.pdf" ,
                image:        { type: 'jpeg', quality: 1 },
                margin:        [top = 0, left = 0, bottom = 0, right = 0],
                html2canvas:    {height: 800}
            };

            html2pdf(element, opt)

        }
        function AparecerSolar(){

            if (document.getElementById("offgrid").checked){
                document.getElementById("inputoffgrid").style.display = "block";
            }

            else {
                document.getElementById("inputoffgrid").style.display = "none";
            }
        }

        function DimensionarSolar(el){

            var Pp = parseFloat(document.getElementById('Pp').value);
            document.getElementById('PpReport').innerHTML = Pp;
            var Ctd = parseFloat(document.getElementById('Ctm').value);
            document.getElementById('CtmReport').innerHTML = Ctd;
            Ctd = Ctd / 30 *1000 
            var Hspd = parseFloat(document.getElementById('Hspd').value);
            document.getElementById('HspdReport').innerHTML = Hspd;
            var Em = parseFloat(document.getElementById('Em').value);
            document.getElementById('EmReport').innerHTML = Em;

            if (document.getElementById("ongrid").checked)
            {
                var Pg = Ctd / Hspd;
                var PI = Pg + (Pg * (Em/100));
                document.getElementById('PI').innerHTML = PI.toFixed(3);
                var TRD = PI / Pp;
                document.getElementById('TRD').innerHTML = TRD.toFixed(3);
                document.getElementById('OnorOffReport').innerHTML = "On grid";
            }

            else if (document.getElementById("offgrid").checked)
            {
                document.getElementById("resultoffgrid").style.display = "block";
                document.getElementById("inputoffgridReport").style.display = "block";
                document.getElementById('OnorOffReport').innerHTML = "Off grid";
                var TM = parseFloat(document.getElementById('TM').value);
                document.getElementById('TMReport').innerHTML = TM;
                var Tbb = parseFloat(document.getElementById('Tbb').value);
                document.getElementById('TbbReport').innerHTML = Tbb;
                var Autonomia = parseFloat(document.getElementById('Autonomia').value);
                document.getElementById('AutonomiaReport').innerHTML = Autonomia
                var Cb = ( Ctd * Autonomia) / ( Tbb * 0.6);
                document.getElementById('Cb').innerHTML = Cb;
                var Fpp = Tbb / TM;
                var Pg = Ctd / (Hspd * 0.8 * Fpp);
                var PI = Pg + (Pg * (Em/100));
                var TRD = Pg / Pp;
                document.getElementById('TRD').innerHTML = TRD.toFixed(3);
                document.getElementById('PI').innerHTML = PI.toFixed(3);
                var Cc = (Pg * 1.1) / Tbb ;
                document.getElementById('Cc').innerHTML = Cc.toFixed(3);
            }

        }
    </script>
</html>